{{#section "styles"}}
<link rel="stylesheet" href="/static/signup.css" />
{{/section}}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("signupForm");
    const fullName = document.getElementById("fullName");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const terms = document.getElementById("terms");

    //Helper functions 
    function showError(input, message) {
      let feedback = input.nextElementSibling;
      // Nếu chưa có div .invalid-feedback thì tạo mới
      if (!feedback || !feedback.classList.contains("invalid-feedback")) {
        feedback = document.createElement("div");
        feedback.className = "invalid-feedback";
        input.parentNode.appendChild(feedback);
      }
      feedback.textContent = message;
      input.classList.add("is-invalid");
    }

    function clearError(input) {
      const feedback = input.nextElementSibling;
      if (feedback && feedback.classList.contains("invalid-feedback")) {
        feedback.textContent = "";
      }
      input.classList.remove("is-invalid");
    }

    // Live Validation 
    fullName.addEventListener("input", () => {
      if (fullName.value.trim() === "") {
        showError(fullName, "Full name cannot be empty.");
      } else {
        clearError(fullName);
      }
    });

    email.addEventListener("input", () => {
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(email.value.trim())) {
        showError(email, "Please enter a valid email address.");
      } else {
        clearError(email);
      }
    });

    password.addEventListener("input", () => {
      if (password.value.length < 6) {
        showError(password, "Password must be at least 6 characters.");
      } else {
        clearError(password);
      }

      // 
      if (confirmPassword.value !== "") {
        if (confirmPassword.value !== password.value) {
          showError(confirmPassword, "Passwords do not match.");
        } else {
          clearError(confirmPassword);
        }
      }
    });

    confirmPassword.addEventListener("input", () => {
      if (confirmPassword.value !== password.value) {
        showError(confirmPassword, "Passwords do not match.");
      } else {
        clearError(confirmPassword);
      }
    });

    terms.addEventListener("change", () => {
      if (!terms.checked) {
        showError(terms, "You must agree to the Terms and Privacy Policy.");
      } else {
        clearError(terms);
      }
    });

    form.addEventListener("submit", function (event) {
      event.preventDefault(); 

      let isValid = true;

      // Full name
      if (fullName.value.trim() === "") {
        showError(fullName, "Full name cannot be empty.");
        isValid = false;
      }

      // Email
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(email.value.trim())) {
        showError(email, "Please enter a valid email address.");
        isValid = false;
      }

      // Password
      if (password.value.length < 6) {
        showError(password, "Password must be at least 6 characters.");
        isValid = false;
      }

      // Confirm password
      if (confirmPassword.value !== password.value || confirmPassword.value === "") {
        showError(confirmPassword, "Passwords do not match.");
        isValid = false;
      }

      // Terms
      if (!terms.checked) {
        showError(terms, "You must agree to the Terms and Privacy Policy.");
        isValid = false;
      }

      // Nếu có lỗi => hiện SweetAlert
      if (!isValid) {
        Swal.fire({
          icon: "error",
          title: "Form validation error",
          text: "Please fix the highlighted fields and try again.",
        });
        return;
      }

      Swal.fire({
        title: "Register account confirmation?",
        text: "Do you want to create this account?",
        icon: "question",
        showCancelButton: true,
        confirmButtonText: "Yes, create it!",
        cancelButtonText: "Cancel",
      }).then((result) => {
        if (result.isConfirmed) {
          form.submit();
          Swal.fire({
            icon: "success",
            title: "Account created!",
            text: "Your account has been successfully registered.",
          });
        }
      });
    });
  });
</script>
